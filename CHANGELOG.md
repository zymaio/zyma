# 更新日志 (Changelog)

本项所有显著更新都将记录在此文件中。

## [0.9.6] - 2026-02-03

### 🚀 Zyma-ShovX 架构融合与工业级底座演进
本次更新完成了 Zyma 历史上最深刻的一次架构重构，将项目彻底转变为“底座库 + 宿主 App”的现代大型工程模式，为 ShovX Pro 等闭源/定制化 App 提供了坚实的开源底座。

#### 🏗️ 架构大重塑：组件库化 (@zyma/ui)
- **依赖注入 (DI) 模式贯通**: 核心组件 `Workbench` 不再依赖隐式全局状态，全面通过 Props 接收 `fm` (文件管理)、`tabSystem` (标签系统)、`logic` (控制器) 等驱动器。
- **ZymaApp 核心化**: 剥离业务逻辑，`ZymaApp.tsx` 成为自包含的 IDE 引擎入口。`App.tsx` 简化为纯净的示例/业务注入层，支持注入 `brand` (品牌) 和 `welcomeExtra` (自定义启动内容)。
- **Hook 职责深度解耦**: 
    - `useUIState`: 独立管理面板显隐等交互状态。
    - `useNativeExtensions`: 自动发现并注册后端注入的原生 AI 参与者、账号提供商。
    - `useWorkbenchLogic`: 专注于工作区管理与环境同步。
- **Context 性能优化**: 扁平化 Context 依赖，解决因全局设置更新导致的“全量组件重绘”性能瓶颈。

#### 📄 文件系统与编码革命
- **智能编码检测**: 集成 `chardetng` (Mozilla) 与 `encoding_rs`。系统现在能**自动识别**并正确打开 ANSI (GBK)、UTF-8 等不同编码的源码文件，彻底告别乱码。
- **状态栏编码联动**: 状态栏现在实时显示当前文件的真实编码，对于无法确定的编码显示“未知”。
- **持久化 UID 系统**: 为每个打开的文件引入持久 `uid`。解决“另存为”导致的编辑器实例重置问题，完美保留 Undo 历史与滚动位置。

#### 💄 界面与工程化精进
- **样式隔离加固**: 将全局 CSS 规则锁定在 `.app-root` 内，防止底座库污染外部宿主应用的样式环境。
- **稳定性防线**: 为所有插件视图和侧边栏面板全局包裹 `ErrorBoundary`。单个插件崩溃不再导致整个 IDE 白屏。
- **国际化 (i18n) 逻辑修正**: 修复了初始化时的语言同步竞态 Bug，确保中文环境下“开箱即中”。
- **冗余代码大扫除**: 合并了 `useFileIO` 与 `useFileManagement`，删除了大量过时的配置与 Hook 文件。

## [0.9.5] - 2026-01-24

### 🚀 自动更新系统与工业级稳定性加固
此版本标志着 Zyma 具备了完整的生命周期管理能力，通过集成官方更新插件和重构底层 IO 逻辑，系统健壮性大幅提升。

#### ✨ 核心功能：全自动在线更新
- **多镜像分发**: 集成 `tauri-plugin-updater`，配置 GitHub 与 Gitee 双端点，确保国内用户也能极速升级。
- **安全签名**: 引入 Ed25519 数字签名校验，确保更新包的来源真实可靠。
- **非侵入式提示**: 状态栏右下角增加静默更新标记（小绿点），避免弹窗打断工作流。支持点击版本号一键安装并自动重启。

#### 🛠️ 性能与体验优化
- **编辑器懒加载**: 重构 `Editor.tsx`，将 20+ 种语言解析包改为动态导入。仅在打开对应文件时加载，显著降低初始内存占用。
- **高性能并行搜索**: 使用 `ignore` (ripgrep核心) 和 `num_cpus` 库重构搜索后端。支持多线程并行扫描，并自动尊重 `.gitignore` 设置。
- **路径标准化**: 彻底解决 Windows 环境下由于路径大小写、斜杠不统一导致的“重复标签页”和“切换失效”等顽固 Bug。
- **安全防护**: 后端增加 5MB 文件读取上限，防止因意外打开超大日志文件导致的 UI 假死。

#### 🧹 代码与架构清理
- **移除死代码**: 删除了未启用的 AI 窗口占位代码，保持核心库轻量纯净。
- **动态版本联动**: 状态栏版本号与 `Cargo.toml` 实时同步，消除硬编码。
- **监听器泄露修复**: 重构 `App.tsx` 生命周期，引入初始化锁，彻底杜绝异步监听器导致的竞态冲突。

## [0.9.4] - 2026-01-23

### 🚀 VS Code 核心复刻与 AI Ready 架构升级
这是 Zyma 迈向专业 IDE 的重要里程碑版本，建立了高度解耦的插件化架构，并全面支持 AI Agent 零修改接入。

#### ✨ 核心特性复刻
- **命令系统 (Command Palette)**: 实现了标准的命令注册中心与 `Ctrl+Shift+P` 快捷搜索面板，支持全系统功能检索。
- **全局搜索重构**: 全局搜索结果现在按文件路径分组显示，支持点击跳转至具体行号，体验完全对齐 VS Code。
- **动态视图系统**: 侧边栏支持通过 `ViewRegistry` 动态注册面板，Activity Bar 自动映射图标。
- **编辑器搜索 (Ctrl+F)**: 复刻了右上角浮动搜索框，支持大小写、全字及正则模式，彻底屏蔽原生简陋 UI。
- **可调节侧边栏**: 实现可拖拽调整宽度的侧边栏，支持 `Ctrl+B` 一键隐藏/显示。
- **标签页增强**: 补全了标签页右键菜单（关闭左侧、关闭右侧、关闭其他等），并支持根据上下文动态禁用选项。
- **路径面包屑**: 顶部实时显示文件路径导航；状态栏增加光标位置、编码、语言模式及未保存标记。

#### 🧩 插件系统与 AI 接入能力
- **AI 窗口 API**: 注入 `zyma.window.create`，允许插件创建独立的专用悬浮窗口。
- **纯净渲染模式 (Clean Mode)**: 辅助窗口不再加载编辑器核心，仅作为插件挂载点，避免资源浪费。
- **Workspace API**: 插件获得完整的文件系统读写权限，为 AI 的工程感知（RAG）打下基础。
- **零修改接入**: AI 功能可作为独立插件运行，无需触碰 Zyma 核心源码。

#### 🛠️ 架构改进
- **极致模块化**: `App.tsx` 逻辑重构至 `useFileManagement` Hook；`i18n` 资源分离至 JSON 独立文件。
- **稳定性增强**: 使用 `window.destroy()` 彻底解决退出时的循环拦截 Bug；引入 `ErrorBoundary` 错误边界。

## [0.9.3] - 2026-01-13
- (内容略)
