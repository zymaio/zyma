# 更新日志 (Changelog)

本项所有显著更新都将记录在此文件中。

## [Unreleased]

### 🚀 架构大重塑：极致解耦与 IDE 平台化进阶
本次更新标志着 Zyma 从一个轻量级编辑器正式进化为一个通用的、高性能的插件化 IDE 宿主平台。通过深度模块化和全量事件驱动设计，建立了工业级的开发底座。

#### 🧩 深度事件驱动插件 API (v1.1)
- **复刻 VS Code 事件模型**: 提供了完整的“感知系统”，支持插件实时监听：
    - `workspace.onDidSaveTextDocument`: 文件保存。
    - `workspace.onDidOpenTextDocument`: 文件打开/切换。
    - `workspace.onDidCreateFiles / onDidChangeFiles / onDidDeleteFiles`: 文件系统增删改。
    - `window.onDidChangeActiveTextEditor`: 标签页焦点切换。
    - `window.onDidChangeWindowState`: 窗口焦点（离开/回来）。
    - `window.onDidChangeTextEditorSelection`: 光标移动与选区变化（已节流）。
- **高性能驱动**: 所有文件系统监听均由 Rust `notify` 引擎承载，JS 插件零负载接收增量通知。
- **内存安全销毁**: 引入 `Disposable` 模式，确保插件卸载或禁用时，所有异步监听器被物理销毁，拒绝内存泄露。

#### 🛠️ 代码治理与模块化深度优化
- **App.tsx 终极瘦身**: 主入口逻辑大幅下沉，引入 `useKeybindings`, `useWindowManagement`, `useAppInitialization` 等专项钩子，布局代码纯净化。
- **插件系统分层重构**: 拆分出 `PluginAPIBuilder` 模块，将生命周期管理与 API 注入逻辑彻底隔离，提升代码健壮性。
- **全系统路径标准化**: 引入全局 `pathUtils` 工具类，统一全平台（Win/Mac/Linux）路径处理逻辑，彻底消灭路径识别 Bug。
- **构建质量达标**: 清理了所有 TypeScript 警告，生产环境 `npm run build` 实现“零报错”通过。

#### 📊 智能输出控制台加固
- **幽灵式显隐交互**: 实现了“初始隐藏，有输出即现，且显示后持久驻留”的高级交互逻辑。
- **多屏位置记忆**: 每个日志频道（Channel）均具备独立的位置和尺寸记忆，支持跨显示器布局恢复。
- **弹窗数据一致性**: 修正了独立窗口的 Props 同步机制，确保弹出监控窗口始终与主界面日志同步。

#### 💄 体验与稳定性修复
- **布局抖动修复**: 解决了设置面板字体调整时的界面剧烈跳动问题。
- **Windows 路径深度兼容**: 修复了 Windows 长路径前缀导致的插件权限冲突。
- **联动关闭逻辑**: 实现了主窗口与所有弹出窗口的有序销毁，消除了退出时的 WebView2 报错。

## [0.9.5] - 2026-01-24

### 🚀 自动更新系统与工业级稳定性加固
此版本标志着 Zyma 具备了完整的生命周期管理能力，通过集成官方更新插件和重构底层 IO 逻辑，系统健壮性大幅提升。

#### ✨ 核心功能：全自动在线更新
- **多镜像分发**: 集成 `tauri-plugin-updater`，配置 GitHub 与 Gitee 双端点，确保国内用户也能极速升级。
- **安全签名**: 引入 Ed25519 数字签名校验，确保更新包的来源真实可靠。
- **非侵入式提示**: 状态栏右下角增加静默更新标记（小绿点），避免弹窗打断工作流。支持点击版本号一键安装并自动重启。

#### 🛠️ 性能与体验优化
- **编辑器懒加载**: 重构 `Editor.tsx`，将 20+ 种语言解析包改为动态导入。仅在打开对应文件时加载，显著降低初始内存占用。
- **高性能并行搜索**: 使用 `ignore` (ripgrep核心) 和 `num_cpus` 库重构搜索后端。支持多线程并行扫描，并自动尊重 `.gitignore` 设置。
- **路径标准化**: 彻底解决 Windows 环境下由于路径大小写、斜杠不统一导致的“重复标签页”和“切换失效”等顽固 Bug。
- **安全防护**: 后端增加 5MB 文件读取上限，防止因意外打开超大日志文件导致的 UI 假死。

#### 🧹 代码与架构清理
- **移除死代码**: 删除了未启用的 AI 窗口占位代码，保持核心库轻量纯净。
- **动态版本联动**: 状态栏版本号与 `Cargo.toml` 实时同步，消除硬编码。
- **监听器泄露修复**: 重构 `App.tsx` 生命周期，引入初始化锁，彻底杜绝异步监听器导致的竞态冲突。

## [0.9.4] - 2026-01-23

### 🚀 VS Code 核心复刻与 AI Ready 架构升级
这是 Zyma 迈向专业 IDE 的重要里程碑版本，建立了高度解耦的插件化架构，并全面支持 AI Agent 零修改接入。

#### ✨ 核心特性复刻
- **命令系统 (Command Palette)**: 实现了标准的命令注册中心与 `Ctrl+Shift+P` 快捷搜索面板，支持全系统功能检索。
- **全局搜索重构**: 全局搜索结果现在按文件路径分组显示，支持点击跳转至具体行号，体验完全对齐 VS Code。
- **动态视图系统**: 侧边栏支持通过 `ViewRegistry` 动态注册面板，Activity Bar 自动映射图标。
- **编辑器搜索 (Ctrl+F)**: 复刻了右上角浮动搜索框，支持大小写、全字及正则模式，彻底屏蔽原生简陋 UI。
- **可调节侧边栏**: 实现可拖拽调整宽度的侧边栏，支持 `Ctrl+B` 一键隐藏/显示。
- **标签页增强**: 补全了标签页右键菜单（关闭左侧、关闭右侧、关闭其他等），并支持根据上下文动态禁用选项。
- **路径面包屑**: 顶部实时显示文件路径导航；状态栏增加光标位置、编码、语言模式及未保存标记。

#### 🧩 插件系统与 AI 接入能力
- **AI 窗口 API**: 注入 `zyma.window.create`，允许插件创建独立的专用悬浮窗口。
- **纯净渲染模式 (Clean Mode)**: 辅助窗口不再加载编辑器核心，仅作为插件挂载点，避免资源浪费。
- **Workspace API**: 插件获得完整的文件系统读写权限，为 AI 的工程感知（RAG）打下基础。
- **零修改接入**: AI 功能可作为独立插件运行，无需触碰 Zyma 核心源码。

#### 🛠️ 架构改进
- **极致模块化**: `App.tsx` 逻辑重构至 `useFileManagement` Hook；`i18n` 资源分离至 JSON 独立文件。
- **稳定性增强**: 使用 `window.destroy()` 彻底解决退出时的循环拦截 Bug；引入 `ErrorBoundary` 错误边界。

## [0.9.3] - 2026-01-13
- (内容略)
