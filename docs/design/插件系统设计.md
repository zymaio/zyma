# Zyma 插件系统架构设计 (AI 增强版)

## 1. 设计哲学
**“哑宿主，灵插件”**。
Zyma 提供标准化的编辑器窗口和 AI 聊天 UI，但不内置任何具体的 AI 逻辑。所有的 Agent 能力均通过插件以 `ChatParticipant` 的形式接入。

## 2. AI 协作流程
1. **用户触发**：在 Zyma 侧边栏 Chat 窗口输入问题。
2. **上下文搜集**：Zyma 自动抓取当前打开的文件、选中的代码及对话历史。
3. **插件调度**：Zyma 根据当前活跃的插件，将请求分发给对应的 `handler`。
4. **数据驱动 UI**：插件通过 `stream` API 返回结构化数据。Zyma 负责渲染 Markdown、代码 Diff 视图或工具执行动画。

## 3. 安全与权限
- **文件写入**：插件建议通过 `stream.diff` 发起修改请求，由用户在 Zyma UI 上点击 "Apply" 后触发宿主执行写入。
- **环境隔离**：插件在受限的 JS 沙箱中运行，只能通过 `zyma` 对象访问系统能力。

## 4. 针对初级用户的优化
- **斜杠命令**：插件注册命令后，Zyma 提供自动补全，降低用户的输入门槛。
- **一键采纳**：AI 修改建议以对比框形式呈现，用户无需手动执行复杂的复制代码或对比操作。
- **进度透明化**：通过流式状态同步，将 AI 的“思考”和“工具执行”过程实时可视化，消除用户面对黑盒时的迷茫感。